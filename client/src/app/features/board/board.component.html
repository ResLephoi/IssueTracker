<h1>{{ board.title }}</h1>

<div class="filter-controls">
  <label class="UserFilter" for="userFilter">Filter by User:</label>
  <select id="userFilter" [(ngModel)]="selectedFilter" (change)="filterByUser(selectedFilter)">
    <option value="">All Users</option>
    <option *ngFor="let user of users" [value]="user.id">{{ user.username }}</option>
  </select>
  
  <label for="searchInput">Search:</label>
  <input 
    id="searchInput" 
    type="text" 
    placeholder="Search cards..." 
    [(ngModel)]="searchTerm" 
    (input)="searchCards(searchTerm)"
  />
  
  <button *ngIf="showingFilteredView" (click)="clearFilters()">Clear All Filters</button>
</div>

<div class="board">
  <div class="lists-container">
    <div 
      class="list" 
      *ngFor="let list of board.lists"
      [id]="list.id"
      cdkDropList
      [cdkDropListData]="showingFilteredView ? filteredCards[list.id] : list.cards"
      [cdkDropListConnectedTo]="connectedLists"
      (cdkDropListDropped)="drop($event)"
    >
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 [style.margin]="board.lists.indexOf(list) !== 0 ? '0 0 24px 0' : '0'">{{ list.title }}</h2>
        <button class="btn-success" *ngIf="board.lists.indexOf(list) === 0" (click)="openNewCardDialog(list)">Add Card</button>
        <div *ngIf="board.lists.indexOf(list) !== 0" style="margin-top: 8px"></div>
      </div>
      <div 
        class="card" 
        *ngFor="let card of showingFilteredView ? (filteredCards[list.id] || []) : list.cards" 
        cdkDrag
      >
        <h3>{{ card.title }}</h3>
        <p>{{ card.description }}</p>
        <p *ngIf="card.labels && card.labels.length">Labels: {{ card.labels.join(', ') }}</p>
        <p *ngIf="card.assignedToUserId">Assigned to: {{ getUserById(card.assignedToUserId)?.username }}</p>
        <div class="card-actions">
          <button (click)="editCard(card)">Edit</button>
          <button class="btn-danger" (click)="deleteCard(list, card)">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-card 
  #cardComponent
  [showEditDialog]="showEditDialog"
  [editingCard]="editingCard"
  [currentList]="currentList"
  [users]="users"
  (closeDialogEvent)="closeDialog()"
  (cardSavedEvent)="onCardSaved()"
  (cardDeletedEvent)="onCardDeleted()">
</app-card>